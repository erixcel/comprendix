<div class="grid grid-cols-12 w-full h-full">
  <div class="col-span-12 lg:col-span-12 xl:col-span-2">
    <div class="hidden xl:block h-full">
      <app-actions-vertical
        class="h-full"
        [actionHandlers]="{
          home: goToHome,
          next: goToNext,
          previous: goToPrevious,
        }">
      ></app-actions-vertical>
    </div>
    <div class="xl:hidden w-full">
      <app-actions-horizontal
        class="w-full"
        [actionHandlers]="{
          home: goToHome,
          next: goToNext,
          previous: goToPrevious,
        }">
      ></app-actions-horizontal>
    </div>
  </div>
  
  <div class="col-span-12 lg:col-span-12 xl:col-span-7 flex flex-col justify-center items-center p-6 sm:p-4">
    <!-- Contenedor principal del juego con layout responsivo -->
    <div 
      id="game-container"
      class="relative bg-white rounded-lg shadow-lg p-8 w-full max-w-6xl select-none"
      (mousemove)="onMouseMove($event)"
      (mouseleave)="onMouseLeave($event)"
      (selectstart)="onSelectStart($event)">

      <!-- SVG para las líneas -->
      <svg class="absolute inset-0 w-full h-full pointer-events-none z-0" style="top: 0; left: 0;">
        <!-- Líneas existentes -->
        @for (line of lines; track $index) {
          <line
            [attr.x1]="line.x1"
            [attr.y1]="line.y1"
            [attr.x2]="line.x2"
            [attr.y2]="line.y2"
            [attr.stroke]="line.color"
            stroke-width="4"
            stroke-linecap="round" />
        }
        
        <!-- Línea de arrastre actual -->
        @if (currentLine) {
          <line
            [attr.x1]="currentLine.x1"
            [attr.y1]="currentLine.y1"
            [attr.x2]="currentLine.x2"
            [attr.y2]="currentLine.y2"
            [attr.stroke]="currentLine.color"
            stroke-width="4"
            stroke-linecap="round"
            stroke-dasharray="5,5" />
        }
      </svg>

      <!-- Layout responsivo: columnas lado a lado -->
      <div class="flex flex-col md:flex-row justify-between items-center gap-8 w-full relative z-10">
        
        <!-- Columna de Primeros Textos (Inicios) -->
        <div class="flex-1 space-y-4">
          @for (firstOption of getFirstTextOptions(); track $index) {
            <div class="flex items-center">
              <div 
                [id]="$index.toString()"
                class="flex-1 border-4 rounded-lg p-3 min-h-[3rem] flex items-center select-none transition-all duration-200"
                [style.border-color]="firstOption.color"
                [class.bg-green-50]="isFirstTextMatched($index)"
                [class.shadow-md]="isFirstTextMatched($index)"
                (dragstart)="onDragStart($event)"
                (selectstart)="onSelectStart($event)">
                <span class="text-sm md:text-base font-medium text-gray-800 select-none leading-relaxed">
                  {{ firstOption.text }}
                </span>
              </div>
              <!-- Círculo conector -->
              <div 
                [id]="'connector-first-' + $index"
                class="ml-3 w-5 h-5 rounded-full cursor-pointer hover:scale-110 transition-transform select-none"
                [style.background-color]="firstOption.color"
                [class.ring-4]="isFirstTextMatched($index)"
                [class.ring-green-300]="isFirstTextMatched($index)"
                (mousedown)="onMouseDown($event, $index, 'first')"
                (mouseup)="onMouseUp($event, $index, 'first')"
                (mouseenter)="onMouseEnter($index, 'first')"
                (dragstart)="onDragStart($event)"
                (selectstart)="onSelectStart($event)">
              </div>
            </div>
          }
        </div>

        <!-- Columna de Segundos Textos (Finales) -->
        <div class="flex-1 space-y-4">
          @for (secondOption of getSecondTextOptions(); track $index) {
            <div class="flex items-center">
              <!-- Círculo conector -->
              <div 
                [id]="'connector-second-' + $index"
                class="mr-3 w-5 h-5 rounded-full cursor-pointer hover:scale-110 transition-transform select-none"
                [style.background-color]="secondOption.color"
                [class.ring-4]="isSecondTextMatched($index)"
                [class.ring-green-300]="isSecondTextMatched($index)"
                (mousedown)="onMouseDown($event, $index, 'second')"
                (mouseup)="onMouseUp($event, $index, 'second')"
                (mouseenter)="onMouseEnter($index, 'second')"
                (dragstart)="onDragStart($event)"
                (selectstart)="onSelectStart($event)">
              </div>
              <div 
                [id]="$index.toString()"
                class="flex-1 border-4 rounded-lg p-3 min-h-[3rem] flex items-center select-none transition-all duration-200"
                [style.border-color]="secondOption.color"
                [class.bg-green-50]="isSecondTextMatched($index)"
                [class.shadow-md]="isSecondTextMatched($index)"
                (dragstart)="onDragStart($event)"
                (selectstart)="onSelectStart($event)">
                <span class="text-sm md:text-base font-medium text-gray-800 select-none leading-relaxed">
                  {{ secondOption.text }}
                </span>
              </div>
            </div>
          }
        </div>
      </div>

      <!-- Barra de progreso -->
      <div class="w-full bg-gray-200 rounded-full h-4 mt-8 relative z-10">
        <div
          class="bg-green-500 h-4 rounded-full transition-all duration-500 flex items-center justify-end pr-2"
          [style.width.%]="getCompletionPercentage()">
          @if (getCompletionPercentage() > 15) {
            <span class="text-white text-xs font-bold">
              {{ getCompletionPercentage().toFixed(0) }}%
            </span>
          }
        </div>
      </div>

      <!-- Botón reiniciar -->
      <button
        (click)="resetGame()"
        class="w-full mt-4 bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg transition-colors duration-200 relative z-10">
        Reiniciar Juego
      </button>
    </div>
  </div>
  <div class="col-span-12 xl:col-span-3 flex items-center justify-center p-6">
    <img class="max-h-[30rem] w-auto object-contain select-none" 
         src="./avif/pet/fox_match_image.avif" 
         alt="fox"
         draggable="false"
         (dragstart)="onDragStart($event)"
         (selectstart)="onSelectStart($event)"/>
  </div>
</div>
